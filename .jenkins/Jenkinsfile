@Library(['srePipeline']) _

params = [:]

pipeline {
    agent {
        label 'eti-jenkins-common-xlarge-3'
    }

    stages {
        stage('git clone') {
            steps {
              script{
                //params = sreGetProperties.all( params )
                sh '''
                rm -rf msm-rtsp-stub
                git clone https://github.com/media-streaming-mesh/msm-rtsp-stub.git -b jenkins msm-rtsp-stub
                '''
            }
          }
        }
        stage('BUILD & PUBLISH') {
            steps {
                sh '''
                ${WORKSPACE}/msm-rtsp-stub/.jenkins/build-docker.sh
                '''
            },
            {
                def creds = [
                  usernamePassword(
                    credentialsId: params.JENKINS_DOCKERHUB_CREDS,
                    passwordVariable: 'DOCKERHUB_CISCO_PASS',
                    usernameVariable: 'DOCKERHUB_CISCO_USER')];

                sreDockerHubCisco.withCredentials(creds);
            }
        }
    }
}